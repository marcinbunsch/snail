<% @title = 'Security Groups' %>

<p><%= link_to image_tag('add.png', :alt => 'Create a new Security Group'), '#', :onclick => "$('#group_create').toggle();$('#overlay').toggle()" %> Create a new Security Group</p>
<br/>
<% @groups.each do |group| %>
    <div id="group_<%= group[:aws_group_name] %>" class="group">
        <b><%= group[:aws_group_name] %></b> <%= group[:aws_description] %>
        <%= link_to image_tag('minus.png', :alt => 'Delete Security Group'), "/group/#{group[:aws_group_name]}/delete", :onclick => "return confirm('Delete Security Group: Are you sure?')" %>
        <br/>
        <small>
            <% group[:aws_perms].each do |perm| %>
                <%= perm.inspect %> 
                <% if perm[:group] %>
                    <%= link_to( 
                        '- revoke',
                        "/group/#{group[:aws_group_name]}/revoke?group=#{perm[:group]}&owner=#{perm[:owner]}" 
                    )%>
                <% else %>
                    <%= link_to( 
                        '- revoke',
                        "/group/#{group[:aws_group_name]}/revoke?from=#{perm[:from_port]}&to=#{perm[:to_port]}&protocol=#{perm[:protocol]}&ip=#{perm[:cidr_ips]}" 
                    )%>
                <% end %>
                <br/>
            <% end %>
            <%= link_to '+ Add new rule', '#' %>
        </small>
    </div>
    
<% end %>

<div id="group_create" class="lightbox">
    <h2>Create A Security Group</h2>
    <form action="/group" method="POST">
        <p>Group Name: <input type="text" name="name" /></p>
        <p>Group Description: <input type="text" name="description" /></p>
        <p><input type="submit" value="create"/> <%= link_to 'Cancel', '#', :onclick => "$('#group_create').toggle();$('#overlay').toggle()" %></p>
    </form>
</div>

<div id="group_add_permission" class="lightbox">
    perm
</div>

<div id="overlay" class="lightbox_overlay"/>